# DNS——Domain Name System

## DNS介绍

域名解析系统是应用层的经典例子，它的主要用途是来服务于其它的应用。具体用途就是：把网络中原本记录位置的IP地址，将其映射成人们容易理解的字符串，运行在传输层的UDP协议上，53号端口。

所谓IP地址，就是给计算机分配一个32位的编号：`11000000101010000000000000000001`

对于这个编号，我们辨别起来显然太吃力了，因此我们将其用三个点，分成四段，每段8个位:`11000000.10101000.00000000.00000001`

8位的二进制表示成十进制 一共有256位，因此这个编号就可以这样表示：`192.168.0.1`

但是数字依旧难以辨认，我们把IP地址映射成一个字符串，例如：`www.github.com`，显然方便人们理解，这就是域名系统的作用。


## DNS的问题？

域名系统的实现可不简单，因为互联网的用户数量可以多大几百亿，因此经典映射肯定解决不了。所以在实现时，有三个重要的问题。

1. 如何命名设备？ 
2. 如何完成名字到IP地址的转换
3. 如何维护：增加，删除，修改一个域。


## 分层设计

考虑到数量庞大的用户，很可能会出现重名。在这里DNS用了一个分层结构来设计，通过设计一层层，分布式的设计来缓冲，这样就可以让重名极大减少。

同时分布式的设计，也可以让整个域名系统来分散服务器压力。

具体操作就是，用层次树状结构来命名，先在树根下划分出，顶级域，在顶级域在划分下为各种子域。

顶级域：
- 通用的：.com .edu .gov .int .net .web .org等等
- 国家的：.cn .us .nl .jp

这种顶级域就是我们常见的网站后缀，因此一些企业或者高校就可以在这个域名下直接挂载他们的公司域名。

![image](https://user-images.githubusercontent.com/72189350/210954604-ab006604-a7ef-4c4c-a383-7f6e88c768ff.png)

像图中的edu域名下，就直接挂载了耶鲁大学的域名，耶鲁大学域名下，又挂载了cs学院和eng学院的域名。

通过这样的分层设计就，极大了减少了重名的情况，如果还出现重名，就会在后边加编号的形式来解决。

注意：在这里的域名名字和真实所在的服务器名字不一致，中间有个映射的过程，真实服务器的名字在域名系统中也会经过名字服务器来一层层解析，在下文会说明

## 区域划分

接下来说明如何DNS如何解析域名的。

通过分层设计，我们其实已经把域名划分出来了，但是我们还需要找到域名所在的服务器。因此我们可以再分层的基础上，对于DNS树上的结点进行区域性的划分，这里的划分依据依靠
于，同一个服务器下划分为一个区域。

![image](https://user-images.githubusercontent.com/72189350/210956269-4ddc38d1-fa4e-44a4-a894-5e4f2aea255d.png)

比如这里，再edu下面，耶鲁大学就划分了两个区域，这就是因为服务器的分布而划分的。

因此，现在DNS就可以通过划分的区域，来访问服务器。

补充：全球一共有个13个根域名服务器，不止一个。

**名字服务器**

对于解析IP地址，在这里需要介绍一个名字服务器，在每个划分的区域，都会有一个名字服务器。通过类似我们HTTP报文的方式，让服务器之间进行通信。

## 名字服务器——域名的解析过程

名字服务器，作用就是记录域名——IP地址的映射关系。

报文格式：
- Domain_name：域名
- Ttl：time to live 也就是这个域名资源的生存时间（主要是用于缓存）
- Class：类别，一般都是Internet，简写为IN
- Value：这个就是Domain_name域名对应的IP地址
- Type：资源的类型

![image](https://user-images.githubusercontent.com/72189350/210957774-bfe20770-5a5d-470d-8a02-b3bb4fba20fa.png)


Type的类型：
- A：A类型就是显示这台服务器中，域名对应的IP地址。Name为主机，Value为IP地址
- CNAME：这个就是服务器域名的规范名字。Name为规范名字的别名，Value为规范名字
- NS：这个域名和它的上级域名，Name为域名，Value为上级域名
- MX：有些服务器的名字

主要解释下这里的规范名字，一般我们域名的名字对应的服务器都有另外的名字，因此域名想要找到IP地址，就要用一个规范名字来中间作为跳转找到。

![image](https://user-images.githubusercontent.com/72189350/210958844-1282f47c-dab9-46ad-9e2d-a1a8603d0acc.png)

## 查询过程

### 递归查询

我们的域名系统其实就是一颗树，因此我们所在的域名想要查询一个其它的域名就可以用递归的方法去搜索。

![image](https://user-images.githubusercontent.com/72189350/210959572-26188688-09a7-4bb1-a9a7-81975c7a329c.png)


### 迭代查询

迭代查询也可以解决，首先在叶子结点通过映射一直查询到根结点上去，在根节点要往下查找，就通过获取到该结点，判断是否为查找的结点，如果不是就得到这个结点的下个结点，依次反复。

![image](https://user-images.githubusercontent.com/72189350/210960083-4a2416e0-072c-4061-867a-fc03184fee4c.png)


每次查找完毕，都可以把结点缓存起来，提高效率，用TTL来维护缓存的生命周期（一般两天）

## 解决增删改查一个域

通过上面的设计结构，如果要新增加一个域名。我们其实只要在上级服务器增加两个记录，指向新增的子域的域名和域名服务器的地址。（就是知道你是谁，你在哪个地方） 

然后我们在新增子域的名字服务器加上自己的名字解析：也就是报文Type为A的那个资源，让名字->IP即可。

