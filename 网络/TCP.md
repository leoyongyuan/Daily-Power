# TCP

## OSI七层模型
![image](https://user-images.githubusercontent.com/72189350/202831131-154807c5-b821-4b64-a297-c5808b941126.png)

1.应用层常见协议：
  - FTP(21端口): 文件传输协议
  - SSH(22端口): 远程登陆
  - TELNET(23端口)：远程登录
  - SMTP(25端口)：发送邮件
  - POP3(101端口): 接收邮件
  - HTTP(80端口): 超文本传输协议
  - DNS(53端口): 运行在UDP上，域名解析服务
2.传输层：TCP/UDP
3.网络层：IP,ARP,NAT,RIP

### 路由器，交换机位于哪一层

路由器位于网络层，根据IP地址寻址

交换机位于链路层，根据MAC地址寻址


## TCP报文
![image](https://user-images.githubusercontent.com/72189350/202832021-22d4affa-4e15-4087-858f-2a5bab5fb3c0.png)

上面这个图就是TCP的报文内容，为了下面的三次握手，四次挥手所以先来说明一下一些标识。

1.序号(Sequence Number)：这个是一个随机生成的数字，用来进行传输核对，比如传输给对方，判断对面返回的序列号是否为原序列号 + 1。

2.ACK(Acknowledgment Number): 确认收到序号，在收到对面传输来的消息后，应该放回一个ACK = 1表示我已经收到了。

3.SYN: 用来表示我要建立连接。

4.FIN: 用来表示我要断开连接。


## [TCP三次握手](https://blog.csdn.net/crazymakercircle/article/details/114527369)

第一次握手：c端准备向s端建立连接，c端进入sent模式，发送一个 seq序列号J 和 SYN = 1 给s端。

第二次握手：s端收到了seq序列号J + SYN 后进入rcvd状态，也设置了 SYN = 1 和 seq2序列号K，同时设置好自己已经成功接收到请求的标识，ACK = 1 和 ackseq = J + 1，
并把这四个东西返回给c端。

第三次握手：c端收到了s端的ackseq后，会和原来的J序列号进行比对，如果ackseq = J + 1 并且ACK = 1，则检验通过。同时也返回ACK = 1 和 ackseq = K + 1 给s端。
进入稳定连接状态，s端收到了c端发送的ACK和序列号后，也进行比对，成功后也进入稳定连接状态。

![image](https://user-images.githubusercontent.com/72189350/202832657-88aa5f18-b588-4fa1-b7da-09cbb886b22c.png)


## TCP四次挥手

四次挥手的目的是为了断开连接。
为了方便，在这里我们把主动端断开方称为c端，把被动断开方称为s端。

第一次挥手：c端想断开请求，发送一个FIN = 1 和 seq序列号 M给s端，进入等待状态1.

第二次挥手：s端收到了c端发送的请求后，返回一个ACK = 1，ackseq = M + 1和 seq序列号y，s端进入关闭等待状态。在此时，s端还能发送业务信息给c端。

第三次挥手：在业务信息发送完后，s端会发送FIN = 1，ACK = 1，ackseq = M + 1和 seq序列号k给c端。随后进入ack状态

第四次挥手：c端在收到FIN = 1后，进行ACK核验。最后发送一个ACK = 1，ackseq = k + 1和seq序列号，进入等待2 * MSL状态。s端收到ACK后，也进入关闭状态，c端在2 * MSL时间过后也关闭，
四次挥手结束。

### 为什么关闭连接的需要四次挥手，而建立连接却只要三次握手呢，可不可以四次握手？

### 为什么连接建立的时候是三次握手，可以改成两次握手吗？

### 第三次握手中，如果客户端的ACK未送达服务器，会怎样？

### 如果第二次挥手时服务器的ACK没有送达客户端，会怎样？

### 客户端TIME_WAIT状态的意义是什么？

### 如果已经建立了连接，但客户端出现了故障怎么办？
