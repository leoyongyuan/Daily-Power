# 路由器的分组连接

在路由器的连接有两种，电路交换和分组交换。

现在电路交换基本已经不再使用，取而代之的是共享性更强的分组交换。

## 电路交换

在这里简单介绍下电路交换，电路交换在端对端的建立连接后，利用了叫TDM(时分复用)的方法来实现电路的复用，具体点来说就是对于连接的一条链路，会将其平分为多个个帧，

每个用户只占这个链路的其中之一而已。比如有：一个链路有1000帧，如果给十个用户的话，每个用户只会拥有100帧。

这个方式会导致在线路空闲的时候，每个用户能用的资源依旧只有那么多，这样造成严重的资源浪费。


分组连接通过用转发存储的方式上，解决了这个问题。

## 分组连接

### 转发存储

在一条条链路中，会有很多的中间路由器作为结点，在每次的传输数据时，每次经过一条链路到达下一个中间路由器时，会把数据存储到这个路由器中。这样就刚刚经过的链路就可以释放出来，
让其它的用户使用。

### 排队时延和分组丢失

这种转化存储的方式可以极大的提高共享性，但是也给路由器带来了很多其它的负担。

**分组丢失**

当一个链路中出现了多个用户同时提交的数据，对于这些数据为了维护一个先来后到的顺序，因此在这里会有一个队列来维护，而当数据量大于队列的容量后，队列就会对剩下的分组数据丢掉。

![image](https://user-images.githubusercontent.com/72189350/210163898-33f3e76f-6691-4bf3-87e4-ca6e2e9a2643.png)


**排队时延**
- 节点处理时延(nodal processing delay)
- 排队时延(queueing delay)
- 传输时延(Transmission delay) 就是从节点输出到通信链路所花的时间
- 传播时延(Propagation delay) 就是在距离上传播所花的时间

总的节点延迟就是四者之和 *d*nodal =*d*proc +*d*queue +*d*trans +*d*prop

- dproc = 节点处理时延 典型几个微秒或更小
- dqueue = 排队时延 取决于路由器的拥塞程度
- dtrans = 传输时延 L/R, 低带宽链路比较显著
- dprop = 传播时延 几个微妙到数百毫秒(卫星通信高传播延迟)


**瓶颈链路**

在这里先介绍一个概念，吞吐量。

吞吐量就是单位时间内整个网络传输数据的速率或分组数，简单的理解就是在固定时间上一个链路上传输数据的多少。（单位：bps或datapacketspersecond）

![image](https://user-images.githubusercontent.com/72189350/210164013-ab294d46-ca29-456d-acba-c98b6b280f27.png)

瓶颈链路就是在整个端对端的链条上，吞吐量最小的一个链路，类似木桶效应那样。

![image](https://user-images.githubusercontent.com/72189350/210164055-5b4eb097-42d0-45f1-a82a-54780bd3fe80.png)

