- [å¼‚æ­¥ä¸“é¢˜](#å¼‚æ­¥ä¸“é¢˜)
  - [ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ](#ä»€ä¹ˆæ˜¯å¼‚æ­¥)
  - [Javascriptçš„äº‹ä»¶å¾ªç¯æœºåˆ¶](#javascriptçš„äº‹ä»¶å¾ªç¯æœºåˆ¶)
    - [å‰ç½®çŸ¥è¯†é“ºå«](#å‰ç½®çŸ¥è¯†é“ºå«)
    - [äº‹ä»¶å¾ªç¯](#äº‹ä»¶å¾ªç¯)
      - [å¾ªç¯æœºåˆ¶](#å¾ªç¯æœºåˆ¶)
      - [å¾ªç¯è¿‡ç¨‹](#å¾ªç¯è¿‡ç¨‹)
  - [Promise](#promise)
    - [å›è°ƒ](#å›è°ƒ)
    - [Promiseä»‹ç»](#promiseä»‹ç»)
    - [æ‰‹å†™Promise](#æ‰‹å†™promise)
      - [1.çŠ¶æ€å˜åŒ–](#1çŠ¶æ€å˜åŒ–)
      - [2.Promiseè¿”å›å€¼](#2promiseè¿”å›å€¼)
      - [3.å¤šé‡å›è°ƒ å€¼ç©¿é€ catchå¼‚å¸¸ç©¿é€](#3å¤šé‡å›è°ƒ-å€¼ç©¿é€-catchå¼‚å¸¸ç©¿é€)
      - [Promise.all()](#promiseall)
      - [Promise.race()](#promiserace)
      - [Promiseä»£ç ](#promiseä»£ç )
    - [é¢è¯•ä¾‹é¢˜](#é¢è¯•ä¾‹é¢˜)
  - [async awiat](#async-awiat)
      - [é¢è¯•ä¾‹é¢˜](#é¢è¯•ä¾‹é¢˜-1)
  - [ç»¼åˆé¢˜](#ç»¼åˆé¢˜)
    - [ç»¼åˆäº‹ä»¶å¾ªç¯](#ç»¼åˆäº‹ä»¶å¾ªç¯)
    - [å®ç°ä¸€ä¸ªsleepå‡½æ•°](#å®ç°ä¸€ä¸ªsleepå‡½æ•°)
    - [å®ç°æ¯éš”1ç§’è¾“å‡º1,2,3](#å®ç°æ¯éš”1ç§’è¾“å‡º123)
    - [å®ç°çº¢ç»¿ç¯äº¤æ›¿é‡å¤äº®](#å®ç°çº¢ç»¿ç¯äº¤æ›¿é‡å¤äº®)

# å¼‚æ­¥ä¸“é¢˜

å¼‚æ­¥æ˜¯åœ¨Javascriptç»§åŸå‹é“¾åçš„åˆä¸€å¤§éš¾ç‚¹ï¼Œè€Œä¸”ç»å¸¸åœ¨å®é™…å¼€å‘ä¸­ç»å¸¸é‡åˆ°å¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥å¤§å®¶åº”è¯¥ä¸é™Œç”Ÿï¼Œåœ¨é¢è¯•ä¸­ä¹Ÿå¾€å¾€ä¼šé…åˆäº‹ä»¶å¾ªç¯æœºåˆ¶ç­‰çŸ¥è¯†ç‚¹ç»“åˆå‡ºç»„åˆæ‹³æš´æ‰“æ±‚èŒè€…ã€‚

æ‰€ä»¥è¿™ä¸ªçŸ¥è¯†ç‚¹æ˜¯éå¸¸å…³é”®ä¸”é‡è¦çš„ï¼Œæœ¬æ–‡å¥½å¥½æ‹ä¸€ä¸‹å¼‚æ­¥çš„æ•´ä¸ªçŸ¥è¯†è„‰ç»œï¼ŒåŒ…æ‹¬Promiseå’Œäº‹ä»¶å¾ªç¯æœºåˆ¶ç­‰å†…å®¹ã€‚

å¥½äº†ï¼Œè¯ä¸å¤šè¯´ç›´æ¥è¿›å…¥æ­£é¢˜ã€‚

## ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ

å’Œå¼‚æ­¥æœ‰ä¸ªç›¸å¯¹çš„æ¦‚å¿µå«åšåŒæ­¥ã€‚

æ‰€è°“åŒæ­¥ï¼Œå°±æ˜¯æŒ‰ç…§ä½ çš„ä»£ç é¡ºåºè¿›è¡Œæ‰§è¡Œï¼Œè€Œå¼‚æ­¥ä¸æŒ‰ç…§ä»£ç é¡ºåºæ‰§è¡Œï¼Œå› æ­¤æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚

å¼‚æ­¥ä»»åŠ¡ä¼šåœ¨æµè§ˆå™¨å•ç‹¬ä¸­å¼€å‡ºä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Œç­‰åŒæ­¥ä»»åŠ¡è¿›è¡Œå®Œåœ¨æŠŠå¼‚æ­¥ä»»åŠ¡åŠ å…¥æ‰§è¡Œæ ˆã€‚

![image](https://user-images.githubusercontent.com/72189350/201929001-14cf8ccf-7bfc-411e-99e5-66b33f7d0e68.png)


## Javascriptçš„äº‹ä»¶å¾ªç¯æœºåˆ¶

### å‰ç½®çŸ¥è¯†é“ºå«

åœ¨è®²äº‹ä»¶å¾ªç¯ä¹‹å‰ï¼Œæˆ‘è§‰å¾—åº”è¯¥æ¥è¿™é‡Œç®€å•é“ºå«ä¸€ä¸‹æµè§ˆå™¨ç¯å¢ƒã€‚

æµè§ˆå™¨æœ‰4å¤§è¿›ç¨‹ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå«Rendererè¿›ç¨‹å°±æ˜¯ç”¨æ¥å¤„ç†Javascriptçš„ï¼Œè¿™ä¸ªè¿›ç¨‹ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„æµè§ˆå™¨å†…æ ¸ã€‚

åœ¨è¿™ä¸ªè¿›ç¨‹ä¸‹é¢åˆåˆ†ä¸º5ä¸ªçº¿ç¨‹

- GUI æ¸²æŸ“çº¿ç¨‹
- Javascriptå¼•æ“çº¿ç¨‹  ä¸»è¦åœ¨äº‹ä»¶å¾ªç¯æä¾›æ‰§è¡Œæ ˆ
- å®šæ—¶å™¨è§¦å‘çº¿ç¨‹
- äº‹ä»¶è§¦å‘çº¿ç¨‹  ä¸»è¦åœ¨äº‹ä»¶å¾ªç¯æä¾›ä»»åŠ¡é˜Ÿåˆ—
- å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹

å‘ç°æ²¡æœ‰ï¼Œè¿™é‡Œé¢5ä¸ªçº¿ç¨‹ï¼Œå°±æœ‰ä¸¤ä¸ªæ˜¯æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ğŸ˜€

é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“Javascriptæ˜¯å•çº¿ç¨‹ç¼–ç¨‹ï¼Œä¹Ÿå°±æ˜¯Javascriptåœ¨ä¸€ä¸ªæ—¶é—´åªèƒ½å¹²ä¸€ä»¶äº‹ã€‚

å’¦ï¼Œä¹‹å‰ä¸æ˜¯è¯´æœ‰5ä¸ªçº¿ç¨‹å—ï¼Ÿæ€ä¹ˆç°åœ¨åˆå«å•çº¿ç¨‹äº†(O_o)??

å®é™…ä¸Šæˆ‘ä»¬æ‰€è¯´çš„å¤šçº¿ç¨‹æŒ‡çš„æ˜¯èƒ½å¦æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œå¹¶å‘æ‰§è¡Œï¼Œè€Œä¸æ˜¯è¯´æœ‰å¤šå°‘ä¸ªçº¿ç¨‹ï¼ŒJavascriptæ˜¾ç„¶æ˜¯åšä¸åˆ°è¿™ç‚¹çš„ï¼Œåœ¨è¿™é‡ŒJavascriptçš„å„ä¸ªçº¿ç¨‹å…¶å®åªèƒ½å¤„ç†å„è‡ªç‰¹å®šçš„äº‹æƒ…ã€‚
è¿™è¿˜ä¸ç®—GUIå’Œå¼•æ“çº¿ç¨‹ä¹‹é—´è¿˜æ˜¯äº’æ–¥çš„ï¼Œå› æ­¤Javascriptæ˜¯å•çº¿ç¨‹çš„ã€‚

ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡çš„åŸå› åœ¨äºå‰ç«¯æ˜¯äºç”¨æˆ·äº¤äº’çš„ï¼Œæ¯”å¦‚ä¸€ä¸ªDOMå…ƒç´ è¢«ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œé‚£å°±ä¼šé€ æˆå¾ˆå¤šéº»çƒ¦ã€‚

### äº‹ä»¶å¾ªç¯

å¥½äº†ï¼Œå‰ç½®çŸ¥è¯†é“ºå«å®Œå°±å¯ä»¥å¼€å§‹è¿›å…¥é‡å¤´æˆäº†ã€‚

é‚£ä¹ˆäº‹ä»¶å¾ªç¯æ˜¯å•¥å‘¢ï¼Ÿ

æˆ‘ä¹Ÿä¸æ‰¯ä»€ä¹ˆå®˜æ–¹è§£é‡Šäº†è¿™é‡Œç›´æ¥ç”¨å¤§ç™½è¯è§£é‡Šï¼Œäº‹ä»¶å¾ªç¯å…¶å®å°±æ˜¯æµè§ˆå™¨å¤„ç†Javascriptä»£ç çš„è¿‡ç¨‹ã€‚

#### å¾ªç¯æœºåˆ¶

æ—¢ç„¶è¯´æ˜¯äº‹ä»¶å¾ªç¯ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯æœ‰å‡ ä¸ªæä¾›å¾ªç¯æµåŠ¨çš„å…³é”®ç»“ç‚¹ï¼š

- ä¸»è§’1ï¼šJavascriptå¼•æ“çº¿ç¨‹ä¸­çš„æ‰§è¡Œæ ˆï¼Œç”¨æ¥å¤„ç†Javascriptä»£ç æ‰§è¡Œï¼Œæ¯æ¬¡ä»å¾ªç¯é˜Ÿåˆ—ä¸­å–å‡ºä»£ç æ‰§è¡Œã€‚
- ä¸»è§’2: äº‹ä»¶è§¦å‘çº¿ç¨‹ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œå–å‡ºWebApiä¸­çš„æ‰§è¡Œå¥½çš„ä»£ç ï¼Œæ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚
- ä¸»è§’3ï¼šWebApiï¼Œå–å‡ºæ‰§è¡Œæ ˆä¸­Javascriptçš„å¼‚æ­¥ä»£ç ï¼Œå¼€å…¶å®ƒçº¿ç¨‹æ‰§è¡Œï¼Œæ‰§è¡Œå®Œåä¸¢åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚

å› æ­¤æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯ï¼Œæ‰§è¡Œæ ˆæŒ‰é¡ºåºæ‰§è¡Œä»£ç ï¼Œå¦‚æœä¸ºåŒæ­¥ä»£ç åˆ™ç›´æ¥æ‰§è¡Œï¼Œé‡åˆ°å¼‚æ­¥ä»£ç å°±ä¸¢WebApiä¸­ã€‚å½“åŒæ­¥ä»£ç å…¨éƒ¨æ‰§è¡Œå®Œåï¼Œå–å‡ºWebApiæ‰§è¡Œå¥½çš„å¼‚æ­¥ä»£ç ï¼Œæ”¾è¿›ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚

æ‰§è¡Œæ ˆåœ¨æŒ‰é¡ºåºå–å‡ºä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»£ç æ‰§è¡Œã€‚
![image](https://user-images.githubusercontent.com/72189350/201939287-342ee9b9-4318-481d-81eb-59e68a9a1eb6.png)

#### å¾ªç¯è¿‡ç¨‹

åœ¨è¿™æ•´ä¸ªå¾ªç¯è¿‡ç¨‹ï¼Œæœ‰ä¸¤ä¸ªå¦‚é›·è´¯è€³çš„æ¦‚å¿µğŸ˜€ï¼Œå®ä»»åŠ¡/å¾®ä»»åŠ¡ã€‚

å®ä»»åŠ¡ï¼š
- scriptä»£ç 
- å®šæ—¶å™¨
- I/O
- uiäº¤äº’ç­‰

å¾®ä»»åŠ¡ï¼š
- new Promise().then(å›è°ƒ)  æ³¨æ„è¿™é‡Œæ˜¯å›è°ƒå“¦
- MutationObserver(html5 æ–°ç‰¹æ€§)


è¿™ä¸¤ä¸ªæ¦‚å¿µå…¶å®æ˜¯å¯¹äºäº‹ä»¶å¾ªç¯ä¸­å¼‚æ­¥ä»»åŠ¡çš„ä¸€ä¸ªåˆ†ç±»ï¼Œæˆ‘ä»¬çš„æ¯ä¸€è½®äº‹ä»¶å¾ªç¯ç»“æŸï¼Œéƒ½ç›¸å½“äºè¿›è¡Œäº†ä¸€æ¬¡å®ä»»åŠ¡+ å¾®ä»»åŠ¡ã€‚

æ‰§è¡Œå®ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œè¯¥å®ä»»åŠ¡äº§ç”Ÿçš„å¾®ä»»åŠ¡ï¼Œè‹¥å¾®ä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿäº†æ–°çš„å¾®ä»»åŠ¡ï¼Œåˆ™ç»§ç»­æ‰§è¡Œå¾®ä»»åŠ¡ï¼Œå¾®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†å›åˆ°å®ä»»åŠ¡ä¸­è¿›è¡Œä¸‹ä¸€è½®å¾ªç¯ã€‚

ä¸¾ä¸ªä¾‹å­ï¼šå½“æˆ‘ä»¬æ‰§è¡Œå®ŒåŒæ­¥ä»£ç åï¼Œå¼€å§‹æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—ä¸­çš„å¼‚æ­¥ä»£ç ï¼Œå› ä¸ºå¼‚æ­¥ä»»åŠ¡å¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼Œæ‰€ä»¥å°±ä¼šåˆ†æˆä¸€è½®è½®çš„å®ä»»åŠ¡ï¼Œè€Œå‡å¦‚åœ¨è¿™ä¸ªå¼‚æ­¥ä»»åŠ¡ä¸­ï¼Œæ¯”å¦‚è¯´å®šæ—¶å™¨ä¸­æœ‰ä¸ªPromise.then()å›è°ƒçš„ä»£ç ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡å°±ç®—æ˜¯è¿™è½®å®ä»»åŠ¡çš„å¾®ä»»åŠ¡ï¼Œåº”è¯¥åŠ åˆ°è¿™ä¸ªè¿™è½®å®ä»»åŠ¡ä¸­æ‰§è¡Œã€‚

![image](https://user-images.githubusercontent.com/72189350/201943166-3af526cf-4299-487d-975e-3bafe1a6732e.png)

## Promise

### å›è°ƒ
å›è°ƒå…¶å®æ˜¯æœ€å¸¸è§çš„å¼‚æ­¥ä»£ç äº†ã€‚æ¯”å¦‚æˆ‘ä»¬å°è£…çš„å„ç§ä»£ç ï¼ŒAjaxè¯·æ±‚ï¼Œæ–‡ä»¶è¯·æ±‚ç­‰ã€‚åœ¨ç°åœ¨è¿™ä¸ªæ—¶ä»£å…¶å®å·²ç»ä¸æ¨èä½¿ç”¨å›è°ƒäº†ï¼Œå› ä¸ºå¤šé‡å›è°ƒä¼šå¯¼è‡´å›è°ƒåœ°ç‹±ã€‚
```
// å›è°ƒåœ°ç‹±ä»£ç å®ä¾‹
setTimeout(function () {
    console.log("First");
    setTimeout(function () {
        console.log("Second");
        setTimeout(function () {
            console.log("Third");
        }, 3000);
    }, 4000);
}, 1000);
```
### Promiseä»‹ç»
Promiseå°±æ˜¯æˆ‘ä»¬ç”¨æ¥è§£å†³å›è°ƒåœ°ç‹±çš„æ‰‹æ®µã€‚

Promise æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•° 
- æˆ‘ä»¬å¯ä»¥åˆ›å»º Promise çš„å®ä¾‹ const p = new Promise() 
- new å‡ºæ¥çš„ Promise å®ä¾‹å¯¹è±¡ï¼Œä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œ

å¯¹äºPromiseæˆ‘ä»¬ä¸»è¦æŒæ¡å¦‚ä½•ä½¿ç”¨å®ƒï¼Œæ¯”å¦‚ä¸‰ä¸ªçŠ¶æ€ï¼Œthenï¼Œcatchï¼Œfinallyï¼Œè¿”å›å€¼ç­‰ã€‚

åœ¨è¿™é‡Œç®€å•è¯´æ˜ä¸€ä¸‹Promiseå¦‚ä½•ä½¿ç”¨ï¼š
```Javascript
let p = new Promise((resolve,reject) => {
        resolve('success');   // è°ƒç”¨thenä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°
        // reject('fail);     // è°ƒç”¨thenä¸­ç¬¬äºŒä¸ªå‚æ•°
    })

p.then(value => {
    console.log(value);  //æ‰“å°success ï¼Œè°ƒç”¨äº†resolveè·å–resovleä¸­çš„ä¼ å…¥çš„å‚æ•°ã€‚
},err => {
    console.log(err);
})
```
ä¾‹å¦‚ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬newä¸€ä¸ªå®ä¾‹pï¼Œç„¶åå†Promiseä¸­ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯resolveå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯rejectå‡½æ•°ã€‚è¿™ä¸¤ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥æ”¹å˜pçš„çŠ¶æ€ï¼Œåˆ†åˆ«å¯¹åº”æˆåŠŸå’Œå¤±è´¥ã€‚
å½“è°ƒç”¨æˆåŠŸå‡½æ•°æ—¶ï¼Œä¼šè°ƒç”¨å›è°ƒå‡½æ•°then(resolve,reject)ï¼Œå“ªä¸ªçŠ¶æ€æ”¹å˜åˆ†åˆ«è°ƒç”¨å“ªä¸ªå‡½æ•°ã€‚

æˆ‘ä»¬é€šè¿‡Promiseçš„æ–¹æ³•ï¼ŒæŠŠå›è°ƒå˜æˆäº†ç”¨then()è¿æ¥çš„é“¾å¼è°ƒç”¨æ¨¡å¼ï¼Œè§£å†³äº†å›è°ƒåœ°ç‹±ã€‚

### æ‰‹å†™Promise

ä¸ºäº†æ›´å¥½çš„ç†è§£Promiseå„ç§æœºåˆ¶ï¼Œåœ¨è¿™é‡Œç®€å•çš„å®ç°ä¸€ä¸‹åŸºç¡€çš„Promiseã€‚

åœ¨è¿™é‡Œå…ˆç»™å‡ºåŸºç¡€æ¶æ„ï¼š
```
class Promise {
    constructor(executor) {
        this.state = 'pending'   // PromiseçŠ¶æ€
        this.result = null       // ä¼ å…¥çš„å‚æ•°å€¼
        this.callback = [];      // å­˜å‚¨å›è°ƒå‡½æ•°

        const _this = this;

        function resolve(data) {    
        }
        
        function reject(data) {
        }
        
        executor(resolve,reject);
    }

    then(onResovled,onRejected) {
    }
    
    catch(onRejected) {
    }
}
```

#### 1.çŠ¶æ€å˜åŒ–

åœ¨Promiseä¸­æœ‰ä¸‰ä¸ªçŠ¶æ€ï¼špending(ç­‰å¾…)ï¼Œfulfilled(æˆåŠŸ)ï¼Œrejected(å¤±è´¥)ã€‚

Promiseçš„ä¸€äº›è§„å®šï¼šåªæœ‰ä¸ºpendingçŠ¶æ€æ‰èƒ½è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå…¶å®ƒçŠ¶æ€æ— æ³•è°ƒç”¨å›è°ƒå‡½æ•°ã€‚å…¶å®ç®€å•æ¥è¯´å°±æ˜¯ï¼Œè¿˜æ²¡è°ƒç”¨ä¹‹å‰ä¸ºpendingï¼Œè°ƒç”¨å®Œåä¸ºfulfilledæˆ–è€…rejectedï¼Œè€Œä¸”åªèƒ½è°ƒç”¨å…¶ä¸­ä¸€ä¸ªã€‚

åœ¨Promiseä¸­ï¼Œè°ƒç”¨thenå›è°ƒçš„æ—¶å€™åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯Promiseä¸­åŒæ­¥è¿è¡Œï¼Œä¸€ç§å°±æ˜¯Promiseä¸­å¼‚æ­¥è¿è¡Œã€‚

è¿™åˆ†åˆ«ä¼šå¯¼è‡´ä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§å°±æ˜¯Promiseç§æ˜¯åŒæ­¥è¿è¡Œï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š
```Javascript
let p = new Promise((resolve,reject) => {
        resolve('success');   
    })
p.then(value => {
    console.log(value);  
})
```
æ­¤æ—¶çš„è¿è¡Œé¡ºåºæ˜¯ï¼šå…ˆè°ƒç”¨resolveåï¼ŒçŠ¶æ€ä»pendingå˜ä¸ºfulfillï¼Œç„¶åå†è°ƒç”¨thenä¸­çš„å›è°ƒå‡½æ•°ã€‚

å› æ­¤æˆ‘ä»¬Promiseä¸­å°±æ˜¯è¿™ä¹ˆå®ç°çš„ï¼š
```Javascript
class Promise {
    ...
    
    function resolve(data) {
        if (_this.state !== 'pending') return ;
        _this.state = 'fulfilled';
        _this.result = data;


        setTimeout(() =>{
            //è°ƒç”¨thenä¸­çš„å›è°ƒ   
        })
    }

    function reject(data) {
        if (_this.state !== 'pending') return ;
        _this.state = 'rejected';
        _this.result = data;

        setTimeout(() =>{
            //è°ƒç”¨thenä¸­çš„å›è°ƒ  
        })
    }
    
    then(onResovled,onRejected) {
        if (this.state === 'fulfilled') {
            // è·å–å‡½æ•°çš„è¿”å›å€¼
            setTimeout(() =>{ 
                callback(onResovled)      // è¿™é‡Œè¯´æ˜ä¸€ä¸‹è¿™ä¸ªcallbackå‡½æ•°ï¼Œè¿™é‡Œå…¶å®æ˜¯ä¸€ä¸ªå°è£…çš„å‡½æ•°ï¼Œä¸‹æ–‡ä¼šè§£é‡Šï¼Œåœ¨è¿™é‡Œåªè¦çŸ¥é“çŠ¶æ€æ—¶æ€ä¹ˆå¤„ç†å³å¯ã€‚
            })
        }

        if (this.state === 'rejected') {
            setTimeout(() =>{
                callback(onRejected);  // è¿™é‡Œè¯´æ˜ä¸€ä¸‹è¿™ä¸ªcallbackå‡½æ•°ï¼Œè¿™é‡Œå…¶å®æ˜¯ä¸€ä¸ªå°è£…çš„å‡½æ•°ï¼Œä¸‹æ–‡ä¼šè§£é‡Šï¼Œåœ¨è¿™é‡Œåªè¦çŸ¥é“çŠ¶æ€æ—¶æ€ä¹ˆå¤„ç†å³å¯ã€‚
            })
        }
    }
}
```
é‚£ä¹ˆæˆ‘ä»¬å†æ¥å¤„ç†å¼‚æ­¥æƒ…å†µï¼Œå½“Promiseä¸ºå¼‚æ­¥æƒ…å†µï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»ä¹‹å‰çš„äº‹ä»¶å¾ªç¯å°±çŸ¥é“äº†ï¼Œå¼‚æ­¥ä»»åŠ¡ä¼šåœ¨ä¸‹ä¸€æ¬¡å®ä»»åŠ¡æ‰è¿›è¡Œï¼Œè€Œthenæ˜¯å¾®ä»»åŠ¡ï¼Œå› æ­¤thenä¸­çš„å›è°ƒä¼šå…ˆæ‰§è¡Œã€‚
```Javascript
let p = new Promise((resolve,reject) => {
        setTimeout(() => {
            resolve('success');
        },1000) 
    })
p.then(value => {
    console.log(value);  
})
```
æ­¤æ—¶çš„thenä¸­çš„çŠ¶æ€ä¸ºpendingï¼Œå› æ­¤æˆ‘ä»¬åœ¨thenä¸­è¿˜éœ€è¦åˆ¤è¯»çŠ¶æ€ä¸ºpendingçš„æƒ…å†µï¼Œæ¥ç€æŠŠä¼ è¿›æ¥çš„å‚æ•°å­˜åˆ°callbackæ•°ç»„ä¸­ï¼Œåœ¨åé¢å¼‚æ­¥ä»»åŠ¡è¿›è¡Œåè°ƒç”¨resolveæ”¹å˜çŠ¶æ€æ—¶åœ¨è°ƒç”¨ã€‚
```Javascript
class Promise {
    ...
    
    function resolve(data) {
        if (_this.state !== 'pending') return ;
        _this.state = 'fulfilled';
        _this.result = data;


        setTimeout(() =>{
            _this.callback.forEach(item => {   // å¤„ç†å¤šä¸ªå›è°ƒ
                item.onResovled(data)
            })    
        })
    }

    function reject(data) {
        if (_this.state !== 'pending') return ;
        _this.state = 'rejected';
        _this.result = data;

        setTimeout(() =>{
            _this.callback.forEach(item => {  // å¤„ç†å¤šä¸ªå›è°ƒ
                item.onRejected(data)
            })     
        })
    }
    
    then(onResovled,onRejected) {
        ...
        // å¤„ç†å¼‚æ­¥æƒ…å†µ
        if (this.state === 'pending') {
            this.callback.push({             
                onResovled: function() {
                    callback(onResovled);    // è¿™é‡Œè¯´æ˜ä¸€ä¸‹è¿™ä¸ªcallbackå‡½æ•°ï¼Œè¿™é‡Œå…¶å®æ˜¯ä¸€ä¸ªå°è£…çš„å‡½æ•°ï¼Œä¸‹æ–‡ä¼šè§£é‡Šï¼Œåœ¨è¿™é‡Œåªè¦çŸ¥é“çŠ¶æ€æ—¶æ€ä¹ˆå¤„ç†å³å¯ã€‚
                },
                onRejected: function() {
                    callback(onRejected);    // è¿™é‡Œè¯´æ˜ä¸€ä¸‹è¿™ä¸ªcallbackå‡½æ•°ï¼Œè¿™é‡Œå…¶å®æ˜¯ä¸€ä¸ªå°è£…çš„å‡½æ•°ï¼Œä¸‹æ–‡ä¼šè§£é‡Šï¼Œåœ¨è¿™é‡Œåªè¦çŸ¥é“çŠ¶æ€æ—¶æ€ä¹ˆå¤„ç†å³å¯ã€‚
                }
            })
        }
    }
}
```
#### 2.Promiseè¿”å›å€¼
ä¸‹é¢æˆ‘ä»¬å¼€å§‹Promiseçš„ç¬¬äºŒä¸ªé‡ç‚¹ï¼ŒPromiseçš„è¿”å›å€¼ã€‚

Promiseçš„è¿”å›å€¼å¯ä»¥åšå¾ˆå¤šäº‹ï¼Œæ¯”å¦‚ä¸­æ–­ä¸€ä¸ªPromiseé“¾ï¼Œè·å–thençš„ç»“æœç­‰ä½œç”¨ã€‚
```Javascript
let p = new Promise((resolve,reject) => {
        resolve('success');   
    })
let res = p.then(value => {
    console.log(value);  
})
console.log(res); // [state:fulfilled,result:'undefinded'];
```

Promiseçš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªPromiseï¼Œå¯¹äºè¿™ä¸ªè¿”å›çš„Promiseæˆ‘ä»¬ä¸»è¦å¤„ç†è¿”å›resultå’Œè¿”å›çš„çŠ¶æ€ã€‚


é¦–å…ˆæˆ‘ä»¬æ¥çœ‹æ•´ä½“è¿”å›å€¼ï¼Œæ— è®ºä»€ä¹ˆæƒ…å†µæˆ‘ä»¬éƒ½æ˜¯è¿”å›ä¸€ä¸ªPromiseï¼Œå› æ­¤åœ¨thenä¸­ï¼Œæˆ‘ä»¬çš„ä»£ç ä¹Ÿåº”è¯¥è¿”å›ä¸€ä¸ªPromise

åœ¨è¿™é‡Œæˆ‘ç›´æ¥æŠŠthençš„å®Œæ•´ä»£ç ç»™å‡ºæ¥ï¼Œå’Œä¸Šé¢çš„æ”¹è¿›æ˜¯æˆ‘ä»¬æŠŠæ•´ä¸ªå†…å®¹ç”¨ä¸€ä¸ªnew PromiseåŒ…è£¹èµ·æ¥äº†ã€‚åœ¨æ•´ä¸ªä»£ç å—ä¸­ï¼Œå…¶å®ƒçš„å†…å®¹æˆ‘ä»¬å‰é¢éƒ½å·²ç»å®ç°äº†ï¼Œè¿™æ—¶å€™åªè¦èšç„¦callbackçš„è¿™ä¸ªå‡½æ•°ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¿”å›å€¼å¤„ç†çš„æ ¸å¿ƒå‡½æ•°ã€‚
```Javascript
then(onResovled,onRejected) {
    const _this = this;

    return new Promise((resolve,reject) => {  // è¿”å›å€¼ä¸ºPromise
        function callback(fn) {
            try{
                const res = fn(_this.result);
                // åˆ¤æ–­è¿”å›å€¼æ˜¯å¦ä¸ºPromise
                if (res instanceof Promise) {
                    res.then(x => {
                        resolve(x);
                    },err => {
                        reject(err);
                    })
                } else {    // å¦‚æœä¸æ˜¯Promiseè¿”å›å‡½æ•°ä¸­çš„è¿”å›å€¼
                    // è¿”å›PromiseæˆåŠŸçŠ¶æ€å’Œè¿”å›å€¼ã€‚
                    resolve(res);  
                }
            } catch(e) {
                reject(e)
            }
        }

        if (this.state === 'fulfilled') {
            // è·å–å‡½æ•°çš„è¿”å›å€¼
            setTimeout(() =>{
                callback(onResovled)
            })
        }

        if (this.state === 'rejected') {
            setTimeout(() =>{
                callback(onRejected);  
            })
        }

        // å¤„ç†å¼‚æ­¥æƒ…å†µ
        if (this.state === 'pending') {
            this.callback.push({
                onResovled: function() {
                    callback(onResovled);
                },
                onRejected: function() {
                    callback(onRejected);
                }
            })
        }
    })
}
```
æˆ‘ä»¬æ¥æ•´ç†ä¸€ä¸‹ï¼Œè¿”å›å€¼éœ€è¦å¤„ç†ä»€ä¹ˆï¼Ÿè¿”å›çš„Promiseçš„çŠ¶æ€å’ŒPromiseçš„resultã€‚

é¦–å…ˆï¼Œè¿”å›å€¼çš„çŠ¶æ€æ˜¯éå¸¸å¤æ‚çš„ï¼Œè¿™é‡Œé¢çš„æƒ…å†µéå¸¸å¤šã€‚

åœ¨è¿™é‡Œæˆ‘å…ˆæ¥ä¸€ä¸ªæš´è®ºï¼šä¸€èˆ¬æƒ…å†µè¿”å›Promiseæ—¶çŠ¶æ€rjectedåªæœ‰ä¸¤ç§æƒ…å†µä¼šå‘ç”Ÿï¼šç¬¬ä¸€ç§ï¼šå‡ºç°thenä¸­æŠ›å‡ºé”™è¯¯çš„æƒ…å†µï¼Œç¬¬äºŒç§ï¼šåœ¨thenä¸­returnçš„Promiseè°ƒç”¨äº†reject()

ä¸Šé¢è¿™ä¸ªç»“è®ºä¸ä¸€å®šå¯¹ï¼Œä½†æ˜¯å®é™…ä¸Šä¼šå‘ç°ç¬¦åˆæˆ‘ä»¬ç»å¤§å¤šæ•°æƒ…å†µã€‚

ä¸ºä»€ä¹ˆè¯´ä¸ä¸€å®šå¯¹å‘¢ï¼Ÿå› ä¸ºå½“æˆ‘ä»¬çœç•¥äº†thenä¸­rejectå‚æ•°æ—¶ï¼Œä¼šå‘ç°çŠ¶æ€å˜æˆäº†ç”±è°ƒç”¨äº†thenç§çš„å›è°ƒå‡½æ•°å†³å®šï¼Œå¦‚æœè°ƒç”¨äº†resolveï¼ŒçŠ¶æ€åˆ™ä¸ºæˆåŠŸï¼›åä¹‹ä¸ºå¤±è´¥ã€‚

çœ‹ä¸‹é¢ä¸¤ä¸ªä¾‹å­ï¼šè¿”å›çš„æ˜¯æˆªç„¶ä¸åŒçš„çŠ¶æ€
```Javascript
let p = new Promise((resolve,reject) => {
        reject('success'); 
    })
let res = p.then(value => {
    console.log(value)
},err => {
    console.log(err)
})
console.log(res);   // [fuifilled]

// çœç•¥å‚æ•°
let p = new Promise((resolve,reject) => {
        reject('success'); 
    })
let res = p.then(value => {
    console.log(value)
})
console.log(res);  // [rejected]
```

æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹è¿”å›å€¼ï¼Œè¿”å›å€¼çš„æƒ…å†µæœ‰ä¸‰ç§
- 1.thenä¸­æ²¡æœ‰è¿”å›å€¼
- 2.thenä¸­æœ‰è¿”å›å€¼ï¼Œä½†æ˜¯è¿”å›çš„ä¸æ˜¯Promise
- 3.thenä¸­æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”è¿”å›çš„å€¼ä¸ºPromise

ç¬¬ä¸€ç§æƒ…å†µï¼šresultä¸ºundefined
ç¬¬äºŒç§æƒ…å†µï¼šresultä¸ºreturn çš„å€¼ã€‚
ç¬¬ä¸‰ç§æƒ…å†µï¼šresultä¸ºPromiseè°ƒç”¨æ—¶çš„å‚æ•°ã€‚

å¥½äº†ï¼Œä¸Šé¢çš„æƒ…å†µåˆ†æå®Œæ¯•ï¼Œæˆ‘ä»¬å†æ¥çœ‹è¿™ä»½ä»£ç ã€‚
```Javascript
function callback(fn) {
    try{
        const res = fn(_this.result);
        // åˆ¤æ–­è¿”å›å€¼æ˜¯å¦ä¸ºPromise
        if (res instanceof Promise) {
            res.then(x => {
                resolve(x);
            },err => {
                reject(err);
            })
        } else {    // å¦‚æœä¸æ˜¯Promiseè¿”å›å‡½æ•°ä¸­çš„è¿”å›å€¼
            // è¿”å›PromiseæˆåŠŸçŠ¶æ€å’Œè¿”å›å€¼ã€‚
            resolve(res);  
        }
    } catch(e) {
        reject(e)
    }
}
```
try,catch å°±æ˜¯ç”¨æ¥åˆ¤æ–­æœ‰æ— æŠ›å‡ºé”™è¯¯çš„ï¼Œå¦‚æœæœ‰æˆ‘ä»¬å°±ç›´æ¥è°ƒç”¨rejected()ã€‚

å¦‚æœæˆ‘ä»¬çš„è¿”å›å€¼ä¸ºPromiseï¼Œåˆ™å»è°ƒç”¨thenä¸­çš„å›è°ƒï¼Œçœ‹æˆ‘ä»¬è¿”å›çš„Promiseè°ƒç”¨äº†å“ªä¸ªå‡½æ•°ã€‚

æœ€åå¦‚æœæ”¾å›å€¼ä¸æ˜¯Promiseç±»å‹ï¼Œå°±ç›´æ¥è°ƒç”¨resolve,æŠŠçŠ¶æ€æ›´æ–°ä¸ºæˆåŠŸï¼Œå¹¶æŠŠå‚æ•°æŒ‚è½½åˆ°è¿™ä¸ªPromiseçš„resultä¸Šã€‚

#### 3.å¤šé‡å›è°ƒ å€¼ç©¿é€ catchå¼‚å¸¸ç©¿é€

åˆ°è¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬å·²ç»æŠŠPromiseæ‰€æœ‰æœ€æ ¸å¿ƒçš„ä»£ç éƒ½å®ç°äº†ï¼Œè¿™é‡Œçš„å¤šé‡å›è°ƒå’Œå€¼ç©¿é€ç­‰å†…å®¹ï¼Œå…¶å®éƒ½æ˜¯ä¾èµ–äºä¸Šé¢ä¸¤ä¸ªçš„å®ç°ã€‚

å¤šé‡å›è°ƒï¼šå¦‚æœä»”ç»†è§‚å¯Ÿä¸Šé¢çš„ä»£ç ï¼Œä¸éš¾å‘ç°è¿™å…¶å®å°±æ˜¯é ä¸€ä¸ªå¾ªç¯å’Œè·å–è¿”å›å€¼çš„åä¸æ–­ç”¨æ–°çš„Promiseè¿­ä»£çš„è¿‡ç¨‹ã€‚
```Javascript
_this.callback.forEach(item => {
    item.onResovled(data)
})      
```

å€¼ç©¿é€æ¦‚å¿µï¼šé“¾å¼è°ƒç”¨çš„å‚æ•°ä¸æ˜¯å‡½æ•°æ—¶ï¼Œä¼šå‘ç”Ÿå€¼ç©¿é€ï¼Œå°±ä¼ å…¥çš„éå‡½æ•°å€¼å¿½ç•¥ï¼Œä¼ å…¥çš„æ˜¯ä¹‹å‰çš„å‡½æ•°å‚æ•°ã€‚

ä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹ä¸ªä¾‹å­ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¸­é—´æœ‰ä¸€thenä¸ºç©ºï¼Œä¸ä¼ å…¥å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬ä¾æ—§å¯ä»¥åœ¨ä¸‹ä¸€ä¸ªthenè·å–åˆ°valueçš„å€¼ï¼Œè¿™å°±æ˜¯å€¼çš„ç©¿é€ã€‚
```Javascript
let p = new Promise((resolve,reject) => {
    resolve('success'); 
})

p.then(value => {
    return value
}).then().then(value => {
    console.log(value);
})
```

é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°å€¼çš„ç©¿é€å‘¢ï¼Ÿ

åœ¨è¿™é‡Œæˆ‘ä»¬è¡¥ä¸Šthenä¸­æœ€åä¸€å—å†…å®¹ï¼Œå°±æ˜¯åˆ¤æ–­ä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¸ºå‡½æ•°ï¼Œå¦‚æœä¸ä¸ºå‡½æ•°åˆ™æŠŠå®ƒè®¾ä¸ºä¸€ä¸ªè¿”å›å‚æ•°å€¼çš„å‡½æ•°ï¼Œæ¥ç€åœ¨ånew Promiseä¸­å»æ¥æ”¶æ¥è‡ªä¸Šä¸€ä¸ªä¼ è¿›æ¥çš„å‚æ•°å³å¯ã€‚
```Javascript
then(onResovled,onRejected) {

    // åˆ¤æ–­å›è°ƒå‡½æ•°æ˜¯å¦å­˜åœ¨ å…è®¸ä½¿ç”¨thençš„æ—¶å€™ä¸å†™ä¸€äº›å‚æ•°
    
    if (typeof onRejected !== 'function') {
        onRejected = err => {
            throw err;
        }
    }

    if (typeof onResovled !== 'function') {
        onResovled = value => value;
    }
    
    ...
}
```
è¿™æ ·å€¼ç©¿é€å°±å¯ä»¥è¢«å®ç°ï¼Œåœ¨æˆ‘ä»¬ä¼ å…¥éå‡½æ•°æ—¶ï¼Œå°±è¿”å›ä¸Šä¸€ä¸ªå‚æ•°çš„å€¼ï¼ŒåŒç†æˆ‘ä»¬ä¹ŸæŠŠå¼‚å¸¸ç©¿é€ä¹ŸæŒ‰åŒæ ·çš„æ–¹æ³•å®ç°ï¼Œå¦‚æœå‘ç”ŸæŠ¥é”™ï¼Œå°±æŠŠonRejectedè®¾ä¸ºä¸€ä¸ªæŠ›å‡ºå‚æ•°å€¼çš„å‡½æ•°ï¼Œä¸€ç›´æŠŠé”™è¯¯å¾€ä¸‹æŠ›ã€‚

å¹²è®²å¯èƒ½ä¸å¤ªå¥½ç†è§£ï¼Œè¿˜æ˜¯ç”¨è¿™ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹æµç¨‹ï¼š
```Javascript
let p = new Promise((resolve,reject) => {
    resolve('success'); 
})

p.then(value => {
    return value
}).then().then(value => {
    console.log(value);
})
```
é¦–å…ˆè°ƒç”¨resolveåæ”¹å˜çŠ¶æ€å¹¶ä¼ å…¥å‚æ•°successï¼Œå¼€å§‹è°ƒç”¨thenä¸­çš„å›è°ƒï¼Œthenä¸­å…ˆåˆ¤æ–­æ˜¯å¦ä¼ è¿›æ¥ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœä¸ºå‡½æ•°åˆ™ä¸è¿›è¡Œå€¼ç©¿é€è®¾ç½®ã€‚è¿›å…¥è¿”å›Promiseä¸­ï¼Œå› ä¸ºçŠ¶æ€ä¸ºfulfilledï¼Œæ‰€ä»¥åœ¨callbackä¸­è°ƒç”¨onResolvedå‡½æ•°ï¼Œåœ¨callbackä¸­æœ€ç»ˆä¼šèµ°resolveï¼Œå¹¶ä¸”æŠŠres ä¹Ÿå°±æ˜¯ return value çš„å‚æ•°ä¼ è¿›å»ã€‚(è¿™é‡Œreturn valueçš„å€¼å°±æ˜¯ä¼ è¿›æ¥çš„success)

è¿™æ—¶å€™å¼€å§‹è¿›å…¥ä¸‹ä¸€è½®å›è°ƒï¼Œè¿˜æ˜¯è·Ÿä¹‹å‰ä¸€æ ·ï¼Œåˆ¤æ–­æ˜¯å¦ä¼ å…¥ä¸€ä¸ªå‡½æ•°ã€‚è¿™é‡Œå‘ç°ä¼ è¿›æ¥æ˜¯ç©ºçš„ï¼Œå› æ­¤ä¼šè°ƒç”¨å€¼ç©¿é€è®¾ç½®ï¼Œè®¾ç½®ä¸ºè¿”å›å‚æ•°çš„å‡½æ•°ã€‚å†æ¬¡è¿›å…¥æ–°çš„Promiseä¸­ï¼Œå› ä¸ºçŠ¶æ€ä¸ºfulfilledï¼Œæœ€åä¼šèµ°resolveã€‚è¿›å…¥ä¸‹ä¸€è½®thenå›è°ƒã€‚

åœ¨æœ€åä¸€è½®ä¸­ï¼Œä¸Šä¸€ä¸ªç©ºçš„thenè¢«è®¾ç½®ä¸ºå€¼ç©¿é€ï¼Œå› æ­¤ç›´æ¥åœ¨callbackä¸­è·å–åˆ°äº†successã€‚

è¿™å°±æ˜¯è¿™æ•´ä¸ªå€¼ç©¿é€çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯å¾ˆç»•çš„ï¼Œéœ€è¦ç»†ç»†ä½“ä¼šã€‚

æœ€åæˆ‘ä»¬å†æ¥è¯´ä¸‹catchã€‚

catchæ•è·å¼‚å¸¸ç©¿é€ï¼šcatchçš„å®ç°å…¶å®éå¸¸å®¹æ˜“ï¼Œcatchçš„ä½œç”¨æ˜¯æ¥æ•è·é”™è¯¯çš„ï¼Œå…¶å®ƒå¤§è‡´å†…å®¹å’Œthenæ–¹æ³•ä¸€è‡´ï¼Œæ‰€ä»¥åªéœ€è¦ä¼ å…¥ä¸€ä¸ªonRejectedå‡½æ•°å³å¯ã€‚
```
catch(onRejected) {
    return this.then(undefined,onRejected);
}
```
#### Promise.all()
allå®ç°çš„å°±éå¸¸å®¹æ˜“äº†ï¼Œallçš„å®ç°è¦æ±‚ä¼ å…¥ä¸€ä¸ªå…¨æ˜¯Promiseçš„æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªå…¨æ˜¯Promiseå›è°ƒç»“æœçš„æ•°ç»„ï¼Œå¹¶ä¸”é¡ºåºä¿æŒä¸€è‡´ã€‚

ç›´æ¥ä¸€ä¸ªå¾ªç¯å¥—ä¸Šå»å³å¯ã€‚
```Javascript
static all(promises) {
    // è¿”å›ç»“æœä¸ºPromise
    let cnt = 0,n = promises.length;
    let arr = new Array(n);
    return new Promise((resolve,reject) => {
        for (let i = 0; i < n; i ++ ) {
            promises[i].then(v => {
                cnt ++;
                // ä¸èƒ½ç”¨pushï¼Œå¯èƒ½å­˜åœ¨å¼‚æ­¥ä»»åŠ¡ï¼Œå¯¼è‡´è¿”å›ç»“æœé¡ºåºä¸ä¸€è‡´
                arr[i] = v; 
                if (cnt === n) {
                    resolve(arr);
                }
            },err => {
                reject(err);
            })
        }
    })
}
```

#### Promise.race()
raceå’Œallå·®ä¸å¤šï¼Œä½†æ˜¯raceæ˜¯è¦æ±‚è®©ä¼ è¿›å»çš„å„ä¸ªPromiseèµ›è·‘ï¼Œè¿”å›ä¸€ä¸ªæœ€å¿«çš„Promiseå›è°ƒç»“æœ.
```Javascript
static race(promises) {
    const n = promises.length;
    return new Promise((resolve,reject) => {
        for (let i = 0; i < n; i ++ ) {
            promises[i].then(v => {
                resolve(v);
            },err => {
                reject(err);
            })
        }
    })
}
```
#### Promiseä»£ç 

[Promiseä»£ç é“¾æ¥]()

### [é¢è¯•ä¾‹é¢˜](https://juejin.cn/post/6844904077537574919#heading-41)

è¿™æ˜¯æˆ‘åœ¨æ˜é‡‘ä¸Šçœ‹åˆ°çš„ä¸€ç¯‡æœ‰å…³Promiseçš„é¢˜ç›®ï¼Œä¸Šé¢çš„é¢˜ç›®è€ƒå¯Ÿå†…å®¹éå¸¸ç»¼åˆï¼Œå¯¹æå‡åŸºç¡€éå¸¸æœ‰å¸®åŠ©ï¼Œé“¾æ¥æ”¾åœ¨æ ‡é¢˜äº†ã€‚

æ¥ä¸‹æ¥è¿›å…¥ç»ƒæ‰‹ç¯èŠ‚ï¼Œå·©å›ºä¸€ä¸‹çŸ¥è¯†å§ã€‚
```Javascript
// æ‰“å°é¡ºåº
const promise1 = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve("success");
    console.log("timer1");
  }, 1000);
  console.log("promise1é‡Œçš„å†…å®¹");
});
const promise2 = promise1.then(() => {
  throw new Error("error!!!");
});
console.log("promise1", promise1);
console.log("promise2", promise2);
setTimeout(() => {
  console.log("timer2");
  console.log("promise1", promise1);
  console.log("promise2", promise2);
}, 2000);
```
```
å…¬å¸ƒç­”æ¡ˆï¼š
promise1é‡Œçš„å†…å®¹
promise1,Promise{<pending>}
promise2,Promise{<pending>}
timer1
Uncaught (in promise) Error: error!!!
'timer2'
'promise1' Promise{<resolved>: "success"}
'promise2' Promise{<rejected>: Error: error!!!}
```
è§£æï¼šè¿™ä¸ªé¢˜ç›®è€ƒå¯ŸçŸ¥è¯†ç‚¹éå¸¸å¤šï¼Œäº‹ä»¶å¾ªç¯ï¼Œå¼‚æ­¥è°ƒç”¨Promiseï¼Œå®ä»»åŠ¡/å¾®ä»»åŠ¡ï¼ŒPromiseè¿”å›å€¼ç­‰ã€‚

é¦–å…ˆè¿™ç§æ‰“å°é¡ºåºå…¥æ‰‹ç‚¹è‚¯å®šæ˜¯äº‹ä»¶å¾ªç¯çš„å®ä»»åŠ¡/å¾®ä»»åŠ¡ï¼Œé¦–å…ˆä¼šæŒ‰é¡ºåºæ‰§è¡Œæ•´ç‰‡ä»£ç ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰çš„åŒæ­¥ä»»åŠ¡ã€‚é‚£ä¹ˆæŒ‰åŒæ­¥é¡ºåºæ¥ï¼Œæœ€å¼€å§‹é‡åˆ°äº†promise1,æ­¤æ—¶å‘ç°ä¸ºå®šæ—¶å™¨çš„å¼‚æ­¥è°ƒç”¨ï¼Œåˆ™åŠ å…¥WebApiä¸­åœ¨æŒ‰é¡ºåºè¿›å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—æˆä¸ºä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼Œå‘ç°console.log("promise1é‡Œçš„å†…å®¹")æ‰§è¡Œï¼Œè€Œåæ¨å‡ºpromise1ï¼Œå‘ç°promise1çš„å›è°ƒï¼Œè¿™ä¸ªæ˜¯å¾®ä»»åŠ¡ï¼Œéœ€è¦ç­‰è¿™è½®å®ä»»åŠ¡ç»“æŸæ‰ä¼šè¿›è¡Œä¹Ÿè·³è¿‡ï¼Œè¿è¡Œå…¶å®ƒä¸¤ä¸ªconsole.logï¼Œè€Œåå‘ç°å®šæ—¶å™¨åœ¨åŠ å…¥ä¸€ä¸ªæ–°ä»»åŠ¡çš„åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚

å¼€å§‹æ‰§è¡Œå¾®ä»»åŠ¡ï¼ŒæŠ¥é”™Errorï¼Œå¾®ä»»åŠ¡ç»“æŸå¼€å§‹æ–°çš„å®ä»»åŠ¡ã€‚

æŒ‰é¡ºåºæ‰§è¡Œç¬¬ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè°ƒç”¨resolveæ”¹å˜çŠ¶æ€ï¼Œå¹¶ä¸”æ‰“å°timeråç»“æŸï¼Œè€Œåæ²¡æœ‰å¾®ä»»åŠ¡ç›´æ¥è·³è¿‡ã€‚

åœ¨å¼€å¯ä¸€è½®æ–°çš„å®ä»»åŠ¡æ‰§è¡Œæœ€åçš„å®šæ—¶å™¨ï¼Œç”±äºpromise1çš„çŠ¶æ€å’Œå›è°ƒéƒ½æ‰§è¡Œäº†ï¼Œå› æ­¤æ­¤æ—¶çš„çŠ¶æ€ä¹Ÿå˜æˆäº†resolveå’Œrejectedã€‚
## async awiat
async å’Œ await æ¥æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨Promiseçš„è¯­æ³•ç³–ã€‚

ç”¨æ³•ï¼š
asyncä»¤å‡½æ•°çš„è¿”å›å€¼ä¸ºPromise
```Javascript
async function foo() {
  //1.å¦‚æœè¿”å›å€¼ä¸ºéPromise
  // return 1;    // return Promise.resolve(1)
  
  //2.å¦‚æœè¿”å›å€¼ä¸ºPromise  è¿”å›è¿™ä¸ªPromiseå¯¹è±¡
  // return new Promise((resolve,reject) => {
  //  resolve('success');
  // })
  
  //3.æŠ›å‡ºå¼‚å¸¸
  //throw 'error'   // æ”¾å›å¤±è´¥çŠ¶æ€çš„Promiseå¯¹è±¡
}
```
awaitåœ¨asyncä¸­å®šä¹‰çš„å‡½æ•°ä¸­ä½¿ç”¨ï¼Œawaitåé¢ä¸€èˆ¬è·Ÿä¸€ä¸ªPromiseå¯¹è±¡ã€‚

å¦‚æœä¸æ˜¯Promiseå¯¹è±¡åˆ™æŠŠè¯¥å€¼ä½œä¸ºPromiseçš„å€¼,å¦‚æœæ˜¯ä¸€ä¸ªPromiseè¿”å›ä¸€ä¸ªæˆåŠŸå€¼ã€‚
```Javascript
async function fn() {
    let success = new Promise((resolve,reject) => {
        resolve('success');
    })
    let fail = new Promise((resolve,reject) => {
        reject('fail');
    })
    
    // 1.ä¸ä¸ºPromiseç±»å‹
    let res1 = await 1
    console.log(res)
    
    // 2.æˆåŠŸçš„Promiseç±»å‹
    let res2 = await success
    console.log(res2)   //
    
    // 3.å¤±è´¥çš„Promiseç±»å‹
    try{
        let res3 = await fail
    } catch(e) {
        console.log(e) 
    }
}
```
æˆ‘ä»¬ä¸€èˆ¬ä¼šç»“åˆç€ä½¿ç”¨ï¼Œç”¨å¼‚æ­¥å†™å‡ºç±»ä¼¼åŒæ­¥çš„ä»£ç é£æ ¼ã€‚

åœ¨asyncå‡½æ•°ä¸­çš„ä»£ç ï¼Œå°±æ˜¯ç›¸å½“äºåœ¨ä¸€ä¸ªPromiseä¸­æ“ä½œï¼Œè€Œåœ¨awaitåé¢çš„ä»£ç ï¼Œå°±æ˜¯å‰é¢awaitä¸­çš„å›è°ƒå‡½æ•°ä¸­çš„ä»£ç ã€‚

ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š
```Javascript
async function async1() {
  console.log("async1 start");
  await async2();
  console.log("async1 end");
}
async function async2() {
  console.log("async2");
}
async1();

// è½¬åŒ–æˆPromiseä»£ç ã€‚
async function async1() {
  console.log("async1 start");
  // åŸæ¥ä»£ç 
  // await async2();
  // console.log("async1 end");
  
  // è½¬æ¢åä»£ç 
  new Promise(resolve => {
    console.log("async2")
    resolve()
  }).then(res => console.log("async1 end"))
}
async function async2() {
  console.log("async2");
}
async1();
```

#### é¢è¯•ä¾‹é¢˜
```Javascript
async function async1() {
  console.log("async1 start");
  await async2();
  console.log("async1 end");
}

async function async2() {
  console.log("async2");
}

console.log("script start");

setTimeout(function() {
  console.log("setTimeout");
}, 0);

async1();

new Promise(function(resolve) {
  console.log("promise1");
  resolve();
}).then(function() {
  console.log("promise2");
});
console.log('script end')
```

```
å…¬å¸ƒç­”æ¡ˆï¼š
'script start'
'async1 start'
'async2'
'promise1'
'script end'
'async1 end'
'promise2'
'setTimeout'.
```
åˆ†ææ€è·¯ä¹Ÿå’Œä¸Šé¢çš„é‚£ä¸ªä¾‹é¢˜ä¸€æ ·ï¼Œasyncå…¶å®ä¹Ÿæ˜¯å¯¹Promiseçš„ä¸€ä¸ªç­‰ä»·ä»£æ¢ã€‚

å†æ¥ä¸€é“

```Javascript
async function testSometing() {
  console.log("æ‰§è¡ŒtestSometing");
  return "testSometing";
}

async function testAsync() {
  console.log("æ‰§è¡ŒtestAsync");
  return Promise.resolve("hello async");
}

async function test() {
  console.log("test start...");
  const v1 = await testSometing();
  console.log(v1);
  const v2 = await testAsync();
  console.log(v2);
  console.log(v1, v2);
}

test();

var promise = new Promise(resolve => {
  console.log("promise start...");
  resolve("promise");
});
promise.then(val => console.log(val));

console.log("test end...");
```
```
å…¬å¸ƒç­”æ¡ˆï¼š
'test start...'
'æ‰§è¡ŒtestSometing'
'promise start...'
'test end...'
'testSometing'
'æ‰§è¡ŒtestAsync'
'promise'
'hello async'
'testSometing' 'hello async'
```
## ç»¼åˆé¢˜

### ç»¼åˆäº‹ä»¶å¾ªç¯
```Javascript
const async1 = async () => {
  console.log('async1');
  setTimeout(() => {
    console.log('timer1')
  }, 2000)
  await new Promise(resolve => {
    console.log('promise1')
  })
  console.log('async1 end')
  return 'async1 success'
} 
console.log('script start');
async1().then(res => console.log(res));
console.log('script end');
Promise.resolve(1)
  .then(2)
  .then(Promise.resolve(3))
  .catch(4)
  .then(res => console.log(res))
setTimeout(() => {
  console.log('timer2')
}, 1000)
```
```
å…¬å¸ƒç­”æ¡ˆï¼š
'script start'
'async1'
'promise1'
'script end'
1
'timer2'
'timer1'
```
æ³¨æ„ç‚¹ï¼šè¿™ä¸ªé¢˜ç›®ä¸»è¦æ€è·¯ä¹Ÿæ˜¯ä¾æ‰˜äºäº‹ä»¶å¾ªç¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨async1ä¸­çš„awaitåé¢çš„Promiseæ²¡æœ‰å»æ”¹å˜çŠ¶æ€ï¼Œä¸€ç›´å¤„äºpendingï¼Œå› æ­¤å›è°ƒæ˜¯ä¸ä¼šè¿›è¡Œçš„ã€‚

### å®ç°ä¸€ä¸ªsleepå‡½æ•° 

```Javascript
const sleep = time => {
		return new Promise(resolve => setTimeout(resolve, time));
}

//ç¬¬ä¸€ç§
sleep(1000).then(() => {
		// ...
})

//ç¬¬äºŒç§
async function sleepAsync() {
		console.log('fuck the code')
		await sleep(1000)
		console.log('fuck the code again')
}

sleepAsync()
```

### å®ç°æ¯éš”1ç§’è¾“å‡º1,2,3
```Javascript
//1. è®¾ç½®ä¸‰ä¸ªè¿ç»­æ—¶é—´çš„å®šæ—¶å™¨
for (let i = 1; i <= 3; i ++ ) {
    setTimeout(() => {
        console.log(i);
    },i * 1000)
}

//2. ç”¨thenå›è°ƒé…åˆreduceå®ç°
const arr = [1, 2, 3]
arr.reduce((p, x) => {
    return p.then(() => {
        return new Promise((resovle) => {
            setTimeout(() => {
                resovle(console.log(x))
            },1000)
        })
    })
}, Promise.resolve())


//3. ç”¨awaité˜»å¡å¾ªç¯
function sleep(x) {
    return new Promise((resolve, reject) => {
        setTimeout(() => { resolve(console.log(x)) }, 1000)
    })
}
async function timer() {
    for (let i = 1; i <= 3; i ++ ) {
        await sleep(i);
    }
}

timer();
```

### å®ç°çº¢ç»¿ç¯äº¤æ›¿é‡å¤äº®
```Javascript
function red() {
  console.log("red");
}
function green() {
  console.log("green");
}
function yellow() {
  console.log("yellow");
}
const light = function (timer, cb) {
  return new Promise(resolve => {
    setTimeout(() => {
      cb()
      resolve()
    }, timer)
  })
}
const step = function () {
  Promise.resolve().then(() => {
    return light(3000, red)  // æ³¨æ„è¿™é‡Œè¦è¿”å›Promiseå€¼ï¼Œè®©æ•´ä¸ªå›è°ƒå˜å¾—æœ‰åº
  }).then(() => {
    return light(2000, green)
  }).then(() => {
    return light(1000, yellow)
  }).then(() => {
    return step()
  })
}

step();
```
åœ¨è¿™é‡Œï¼Œå¦‚æœåœ¨thenä¸­ä¸åŠ è¿”å›å€¼ï¼Œåˆ™return undefindedï¼Œä¼šç›´æ¥è°ƒç”¨ä¸‹ä¸€å›è°ƒthenã€‚è€Œå¦‚æœreturn Promiseï¼Œåˆ™ä¼šè¿›å…¥è¿™ä¸ªè¿”å›çš„è¿™ä¸ªPromiseçš„å›è°ƒä¸­ï¼Œä¼šç­‰è¿™ä¸ªsetTimeoutè¿è¡Œå®Œæˆåè°ƒç”¨resolveï¼Œåœ¨å»è°ƒç”¨ä¸‹ä¸€è½®çš„thenã€‚
