# [6248. ç»Ÿè®¡ä¸­ä½æ•°ä¸º K çš„å­æ•°ç»„](https://leetcode.cn/problems/count-subarrays-with-median-k/)(ä¸­å¿ƒæ‰©å±• + å‰ç¼€å’Œ + å“ˆå¸Œ)

## é¢˜ç›®æè¿°
ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ nums ï¼Œè¯¥æ•°ç»„ç”±ä» 1 åˆ° n çš„ ä¸åŒ æ•´æ•°ç»„æˆã€‚å¦ç»™ä½ ä¸€ä¸ªæ­£æ•´æ•° k ã€‚

ç»Ÿè®¡å¹¶è¿”å› num ä¸­çš„ ä¸­ä½æ•° ç­‰äº k çš„éç©ºå­æ•°ç»„çš„æ•°ç›®ã€‚

æ³¨æ„ï¼š

æ•°ç»„çš„ä¸­ä½æ•°æ˜¯æŒ‰ é€’å¢ é¡ºåºæ’åˆ—åä½äº ä¸­é—´ çš„é‚£ä¸ªå…ƒç´ ï¼Œå¦‚æœæ•°ç»„é•¿åº¦ä¸ºå¶æ•°ï¼Œåˆ™ä¸­ä½æ•°æ˜¯ä½äºä¸­é—´é  å·¦ çš„é‚£ä¸ªå…ƒç´ ã€‚
ä¾‹å¦‚ï¼Œ[2,3,1,4] çš„ä¸­ä½æ•°æ˜¯ 2 ï¼Œ[8,4,3,5,1] çš„ä¸­ä½æ•°æ˜¯ 4 ã€‚
å­æ•°ç»„æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªè¿ç»­éƒ¨åˆ†ã€‚
Â 

## ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼šnums = [3,2,1,4,5], k = 4
è¾“å‡ºï¼š3
è§£é‡Šï¼šä¸­ä½æ•°ç­‰äº 4 çš„å­æ•°ç»„æœ‰ï¼š[4]ã€[4,5] å’Œ [1,4,5] ã€‚
```

## ç¤ºä¾‹ 2ï¼š
```
è¾“å…¥ï¼šnums = [2,3,1], k = 3
è¾“å‡ºï¼š1
è§£é‡Šï¼š[3] æ˜¯å”¯ä¸€ä¸€ä¸ªä¸­ä½æ•°ç­‰äº 3 çš„å­æ•°ç»„ã€‚
```

## æç¤ºï¼š
```
n == nums.length
1 <= n <= 10e5
1 <= nums[i], k <= n
nums ä¸­çš„æ•´æ•°äº’ä¸ç›¸åŒ
```

## æ€è·¯åˆ†æï¼š
åˆšå¼€å§‹çœ‹åˆ°ç»´æŠ¤ä¸­ä½æ•°ï¼Œç¬¬ä¸€ååº”è¿˜ä»¥ä¸ºæ˜¯è€ƒå¯¹é¡¶å †å‘¢ï¼Œä»”ç»†ä¸€çœ‹å‘ç°å¥½åƒå¯¹é¡¶å †è¿˜è§£å†³ä¸äº†ï¼Œå¯¹é¡¶å †æ²¡åŠæ³•åŠ¨æ€æ¸…é™¤æ•°æ®å› æ­¤åªèƒ½è€ƒè™‘å…¶å®ƒåšæ³•ã€‚

é‚£æˆ‘ä»¬æ¥æŒ–æ˜ä¸€ä¸‹é¢˜ç›®æœ‰ä»€ä¹ˆéšå«çš„ä¿¡æ¯å§ï¼Œé¢˜ç›®è¦è®©æˆ‘ä»¬æ±‚å‡ºä¸€ä¸ªå­æ•°ç»„ï¼Œè¿™ä¸ªå­æ•°ç»„çš„ä¸­ä½æ•°ä¸ºkå³ä¸ºåˆæ³•ï¼Œé—®æœ‰å¤šå°‘ä¸ªè¿™æ ·çš„æ•°ç»„ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¹ˆä¸€ä¸ªåˆæ³•æ•°ç»„ï¼Œä¸éš¾å‘ç°è¿™ä¸ªæ•°ç»„å¦‚æœåˆæ³•çš„è¯ï¼Œå¦‚æœä¸ºå¥‡æ•°çš„æƒ…å†µï¼Œé‚£ä¹ˆå¿…ç„¶ä¼šæˆå¯¹å‡ºç°ä¸€ä¸ªæ•°æ¯”kå¤§ï¼Œä¸€ä¸ªæ•°æ¯”kå°ï¼Œå¦‚æœä¸ºå¶æ•°çš„è¯ï¼Œå°±ä¼šæ¯”å¥‡æ•°çš„æƒ…å†µå¤šä¸€ä¸ªæ¯”kå¤§çš„æ•°ã€‚

è¿™åº”è¯¥å¾ˆå¥½ç†è§£å§ï¼Œé‚£ä¹ˆååº”åˆ°æ•°ç»„ä¸Šï¼Œå¦‚æœæˆ‘ä»¬æŠŠå¤§äºkçš„æ•°è®¾ä¼š1ï¼ŒæŠŠå°äºkçš„æ•°è®¾ä¸º-1ï¼Œkè‡ªå·±ä¸º0ã€‚

åˆ™åˆæ³•çš„å­æ•°ç»„å°±æ˜¯ï¼Œæ•°ç»„æ±‚å’Œåçš„å€¼ä¸º0 or 1çš„æƒ…å†µï¼Œåˆ°è¿™ä¸€æ­¥å¦‚æœç»éªŒä¸°å¯Œçš„åŒå­¦åº”è¯¥å¾ˆå®¹æ˜“ä¼šæƒ³åˆ°å‰ç¼€å’Œã€‚

ğŸ†—ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æŠŠæ±‚ä¸­ä½æ•°çš„é—®é¢˜è½¬å˜æˆä¸ºäº†ä¸€ä¸ªå‰ç¼€å’Œçš„é—®é¢˜ã€‚

ç»§ç»­å¾€ä¸‹åˆ†æï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¦æ±‚å‡ºæ¥åˆæ³•çš„æƒ…å†µï¼Œå°±æ˜¯å­æ•°ç»„æ±‚å’Œçš„å€¼ä¸º0 or 1 ä¸” å…¶ä¸­çš„ä¸­ä½æ•°ä¸ºkã€‚

æˆ‘ä»¬å¯ä»¥ä»¥kä¸ºä¸­ç‚¹ï¼ŒæŠŠæ•´ä¸ªæ•°ç»„åˆ†æˆå·¦å³ä¸¤è¾¹ã€‚

é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¦æ±‚å¾—åˆæ³•çš„å­æ•°ç»„ï¼Œå°±æ˜¯åœ¨å³è¾¹æ‰¾ä¸€ä¸ªç‚¹jï¼Œå»æšä¸¾å·¦è¾¹[0,k - 1] çš„iç‚¹,

åˆ¤æ–­æ˜¯å¦æ»¡è¶³å‰ç¼€å’Œä¸‹çš„s[j] - s[k] == -(s[k - 1] - s[i]) and s[j] - s[k] ==  -(s[k - 1] - s[i] + 1)ï¼Œåˆ†åˆ«å¯¹åº”ä¸€ä¸ªå¥‡æ•°ï¼Œä¸€ä¸ªå¶æ•°çš„æƒ…å†µã€‚

åˆ†æåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿˜æ˜¯åšä¸äº†è¿™é¢˜ï¼Œé¢˜ç›®çš„næ•°æ®é‡æ˜¯1e5,æˆ‘ä»¬ä¸Šé¢ç›´æ¥æšä¸¾åˆ¤æ–­å¿…ç„¶ä¼šè¶…æ—¶ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ¥ä¼˜åŒ–ä¸€ä¸‹æˆ‘ä»¬çš„åšæ³•ã€‚

ä»”ç»†æƒ³æƒ³ï¼Œå…¶å®æˆ‘ä»¬æšä¸¾å³è¾¹çš„æ—¶å€™ï¼Œå…¶å®åªæ˜¯éœ€è¦ç»Ÿè®¡å·¦è¾¹æ»¡è¶³æƒ…å†µçš„æ•°é‡ï¼Œæ¯”å¦‚ï¼šæˆ‘æšä¸¾å³è¾¹çš„s[j] - s[k] ä¸º 3ï¼Œå› æ­¤æˆ‘å°±éœ€è¦ç»Ÿè®¡å·¦è¾¹ å­æ•°ç»„ä¸º-3çš„æƒ…å†µæœ‰å¤šå°‘ä¸ªï¼Œç„¶åæŠŠä»–ä»¬åŠ èµ·æ¥å°±å¯ä»¥äº†ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨æŠŠå·¦è¾¹çš„æ•°æ®å­˜èµ·æ¥ï¼Œåœ¨æšä¸¾å³è¾¹æ—¶åŠ ä¸Šå³å¯ã€‚é‚£ä¹ˆæ—¶é—´å¤æ‚åº¦ä¸ºO(n),è¿™æ ·å°±å¯ä»¥è¿‡äº†ã€‚

## CPP
```cpp
class Solution {
public:
    int countSubarrays(vector<int>& nums, int k) {
        int n = nums.size();
        unordered_map<int,int> h;
        int idx = 0;
        h[0] = 1;    // å•ç‹¬ä¸ºkçš„æƒ…å†µ
        for (int i = 0; i < n; i ++ ) {
            if (nums[i] == k) idx = i;
        }

        for (int i = idx - 1,cnt = 0; i >= 0; i -- ) {
            if (nums[i] > k) cnt ++;
            else cnt --;
            h[cnt] ++ ;
        }

        int res = h[0] + h[1];  // åŠ ä¸Šå·¦ä¾§ä¸ºå¶æ•°å’Œå•ç‹¬ä¸ºkçš„æƒ…å†µ

        for (int i = idx + 1,cnt = 0; i < n; i ++ ) {
            if (nums[i] > k) cnt ++ ;
            else cnt -- ;
            res += h[-cnt] + h[-cnt + 1];
        }
        return res;
    }
};
```

## Javascript
```Javascript
/**
 * @param {number[]} nums
 * @param {number} k
 * @return {number}
 */
var countSubarrays = function(nums, k) {
    let n = nums.length;
    let idx = nums.indexOf(k);
    let h = new Map();
    h.set(0,1);
    for (let i = idx - 1,cnt = 0; i >= 0; i -- ) {
        if (nums[i] > k) cnt ++;
        else cnt --;
        if (h.has(cnt)) {
            h.set(cnt,h.get(cnt) + 1);
        } else {
            h.set(cnt,1);
        }
    }
    
    let res = h.get(0);
    if (h.has(1)) res += h.get(1);

    for (let i = idx + 1,cnt = 0 ; i < n; i ++ ) {
        if (nums[i] > k) cnt ++;
        else cnt --;
        if (h.get(-cnt))  res += h.get(-cnt);
        if (h.get(-cnt + 1)) res += h.get(-cnt + 1);
    }
    return res;
};
```
